<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32 Traffic Control: Src/lights.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">STM32 Traffic Control
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('lights_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">lights.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Traffic light control and GPIO management.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;stm32f446xx.h&quot;</code><br />
<code>#include &quot;<a class="el" href="uart_8h_source.html">uart.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="lights_8h_source.html">lights.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="systick_8h_source.html">systick.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9a13fc389cd91f944d0143c640cbe00c" id="r_a9a13fc389cd91f944d0143c640cbe00c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lights_8c.html#a9a13fc389cd91f944d0143c640cbe00c">map_lights</a> (void)</td></tr>
<tr class="memdesc:a9a13fc389cd91f944d0143c640cbe00c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize and map traffic light configuration.  <br /></td></tr>
<tr class="separator:a9a13fc389cd91f944d0143c640cbe00c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab10d69640ef114ca3a8310fc08145674" id="r_ab10d69640ef114ca3a8310fc08145674"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lights_8c.html#ab10d69640ef114ca3a8310fc08145674">lights_update</a> (const <a class="el" href="structTrafficLight.html">TrafficLight</a> *light)</td></tr>
<tr class="memdesc:ab10d69640ef114ca3a8310fc08145674"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update traffic light LEDs based on the current light state.  <br /></td></tr>
<tr class="separator:ab10d69640ef114ca3a8310fc08145674"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a28600fa4969492014ddaf9a2b5654e" id="r_a8a28600fa4969492014ddaf9a2b5654e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lights_8c.html#a8a28600fa4969492014ddaf9a2b5654e">lights_set_green</a> (int lightNum1, int lightNum2)</td></tr>
<tr class="memdesc:a8a28600fa4969492014ddaf9a2b5654e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transition a pair of traffic lights to GREEN.  <br /></td></tr>
<tr class="separator:a8a28600fa4969492014ddaf9a2b5654e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7bf2648645474951c27717174ad25f9" id="r_ad7bf2648645474951c27717174ad25f9"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lights_8c.html#ad7bf2648645474951c27717174ad25f9">lights_set_yellow</a> (int lightNum1, int lightNum2)</td></tr>
<tr class="memdesc:ad7bf2648645474951c27717174ad25f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transition a pair of traffic lights from GREEN to YELLOW.  <br /></td></tr>
<tr class="separator:ad7bf2648645474951c27717174ad25f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea8d9b9046ca0ec832cecf6acbff746c" id="r_aea8d9b9046ca0ec832cecf6acbff746c"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lights_8c.html#aea8d9b9046ca0ec832cecf6acbff746c">lights_set_red</a> (int lightNum1, int lightNum2)</td></tr>
<tr class="memdesc:aea8d9b9046ca0ec832cecf6acbff746c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transition a pair of traffic lights from YELLOW to RED.  <br /></td></tr>
<tr class="separator:aea8d9b9046ca0ec832cecf6acbff746c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1657dd919dc16908ad84d19f6ff6091" id="r_aa1657dd919dc16908ad84d19f6ff6091"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lights_8c.html#aa1657dd919dc16908ad84d19f6ff6091">lights_set_initial_state</a> (void)</td></tr>
<tr class="memdesc:aa1657dd919dc16908ad84d19f6ff6091"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set all traffic lights to their initial states.  <br /></td></tr>
<tr class="separator:aa1657dd919dc16908ad84d19f6ff6091"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad98336e38af281911c5f233341f1e6ed" id="r_ad98336e38af281911c5f233341f1e6ed"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lights_8c.html#ad98336e38af281911c5f233341f1e6ed">lights_init</a> (void)</td></tr>
<tr class="memdesc:ad98336e38af281911c5f233341f1e6ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes GPIO output pins.  <br /></td></tr>
<tr class="separator:ad98336e38af281911c5f233341f1e6ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:afa24aeee3ed12e1532bfcfc559a1bfd0" id="r_afa24aeee3ed12e1532bfcfc559a1bfd0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structTrafficLight.html">TrafficLight</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lights_8c.html#afa24aeee3ed12e1532bfcfc559a1bfd0">Light</a> [<a class="el" href="lights_8h.html#a59ce09f1ecc86341f668475f4aaeffca">NUM_LIGHTS</a>]</td></tr>
<tr class="memdesc:afa24aeee3ed12e1532bfcfc559a1bfd0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array of Traffic light structures.  <br /></td></tr>
<tr class="separator:afa24aeee3ed12e1532bfcfc559a1bfd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Traffic light control and GPIO management. </p>
<p>This module implements the logic and GPIO control for a multi-direction traffic system. It:</p><ul>
<li>Manages traffic light states</li>
<li>Handles state transitions</li>
<li>Updates LED outputs using atomic GPIO operations</li>
</ul>
<p>The module operates on a global array of <code><a class="el" href="structTrafficLight.html" title="Traffic light configuration and runtime state.">TrafficLight</a></code> structures, where each element represents one traffic light at the intersection. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad98336e38af281911c5f233341f1e6ed" name="ad98336e38af281911c5f233341f1e6ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad98336e38af281911c5f233341f1e6ed">&#9670;&#160;</a></span>lights_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lights_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes GPIO output pins. </p>
<p>This function enables the required GPIO peripheral clocks and configures the GPIO pins connected to the traffic light LEDs as digital outputs.</p>
<dl class="section note"><dt>Note</dt><dd>Pins are configured in push-pull output mode with default speed and no internal pull-up or pull-down resistors. </dd></dl>

</div>
</div>
<a id="a8a28600fa4969492014ddaf9a2b5654e" name="a8a28600fa4969492014ddaf9a2b5654e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a28600fa4969492014ddaf9a2b5654e">&#9670;&#160;</a></span>lights_set_green()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lights_set_green </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lightNum1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lightNum2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transition a pair of traffic lights to GREEN. </p>
<p>Transitions the specified pair of traffic lights to GREEN state if currently RED. If GREEN, no state change is performed.</p>
<p>After updating the logical state, the corresponding GPIO outputs are updated via <code><a class="el" href="lights_8c.html#ab10d69640ef114ca3a8310fc08145674" title="Update traffic light LEDs based on the current light state.">lights_update()</a></code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lightNum1</td><td>Index of the first traffic light in the pair </td></tr>
    <tr><td class="paramname">lightNum2</td><td>Index of the second traffic light in the pair </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa1657dd919dc16908ad84d19f6ff6091" name="aa1657dd919dc16908ad84d19f6ff6091"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1657dd919dc16908ad84d19f6ff6091">&#9670;&#160;</a></span>lights_set_initial_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lights_set_initial_state </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set all traffic lights to their initial states. </p>

</div>
</div>
<a id="aea8d9b9046ca0ec832cecf6acbff746c" name="aea8d9b9046ca0ec832cecf6acbff746c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea8d9b9046ca0ec832cecf6acbff746c">&#9670;&#160;</a></span>lights_set_red()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t lights_set_red </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lightNum1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lightNum2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transition a pair of traffic lights from YELLOW to RED. </p>
<p>If light in the specified pair is currently YELLOW, they are transitioned to RED state.</p>
<p>After updating the logical state, the corresponding GPIO outputs are updated via <code><a class="el" href="lights_8c.html#ab10d69640ef114ca3a8310fc08145674" title="Update traffic light LEDs based on the current light state.">lights_update()</a></code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lightNum1</td><td>Index of the first traffic light in the pair </td></tr>
    <tr><td class="paramname">lightNum2</td><td>Index of the second traffic light in the pair</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

</div>
</div>
<a id="ad7bf2648645474951c27717174ad25f9" name="ad7bf2648645474951c27717174ad25f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7bf2648645474951c27717174ad25f9">&#9670;&#160;</a></span>lights_set_yellow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t lights_set_yellow </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lightNum1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lightNum2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transition a pair of traffic lights from GREEN to YELLOW. </p>
<p>If light in the specified pair is currently GREEN, they are transitioned to YELLOW state. If RED, no state change is performed.</p>
<p>After updating the logical state, the corresponding GPIO outputs are updated via <code><a class="el" href="lights_8c.html#ab10d69640ef114ca3a8310fc08145674" title="Update traffic light LEDs based on the current light state.">lights_update()</a></code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lightNum1</td><td>Index of the first traffic light in the pair </td></tr>
    <tr><td class="paramname">lightNum2</td><td>Index of the second traffic light in the pair</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

</div>
</div>
<a id="ab10d69640ef114ca3a8310fc08145674" name="ab10d69640ef114ca3a8310fc08145674"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab10d69640ef114ca3a8310fc08145674">&#9670;&#160;</a></span>lights_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lights_update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structTrafficLight.html">TrafficLight</a> *&#160;</td>
          <td class="paramname"><em>light</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update traffic light LEDs based on the current light state. </p>
<p>Sets or resets the RED and GREEN GPIO outputs for a single traffic light using the GPIOB BSRR register. The LED behavior is determined by the <code>state</code> field of the provided <a class="el" href="structTrafficLight.html" title="Traffic light configuration and runtime state.">TrafficLight</a> structure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">light</td><td>Pointer to a <a class="el" href="structTrafficLight.html" title="Traffic light configuration and runtime state.">TrafficLight</a> structure containing the current state and GPIO pin mappings </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9a13fc389cd91f944d0143c640cbe00c" name="a9a13fc389cd91f944d0143c640cbe00c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a13fc389cd91f944d0143c640cbe00c">&#9670;&#160;</a></span>map_lights()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void map_lights </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize and map traffic light configuration. </p>
<p>Populates the global 'Light' array with initial traffic light states, car counts, and GPIO pin mappings. Each traffic light is assigned its corresponding RED and GREEN GPIO pins and an initial state based on expected traffic flow.</p>
<p>High-traffic directions are initialized to GREEM, while low-traffic directions start at RED. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="afa24aeee3ed12e1532bfcfc559a1bfd0" name="afa24aeee3ed12e1532bfcfc559a1bfd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa24aeee3ed12e1532bfcfc559a1bfd0">&#9670;&#160;</a></span>Light</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structTrafficLight.html">TrafficLight</a> Light[<a class="el" href="lights_8h.html#a59ce09f1ecc86341f668475f4aaeffca">NUM_LIGHTS</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Array of Traffic light structures. </p>
<p>Global array of traffic light instances.</p>
<dl class="section note"><dt>Note</dt><dd>The array size is defined by NUM_LIGHTS (4 in this case) </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_413f4e031a85da0d68269c6fd2f76e1c.html">Src</a></li><li class="navelem"><a class="el" href="lights_8c.html">lights.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
